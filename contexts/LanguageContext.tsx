import React, { createContext, useContext, useState, useEffect } from 'react';
import AsyncStorage from '@react-native-async-storage/async-storage';

type Language = 'es' | 'en';

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
}

const translations = {
  es: {
    // Navigation
    home: 'Inicio',
    myPets: 'Mis Mascotas',
    shop: 'Tienda',
    services: 'Servicios',
    petFriendly: 'Pet Friendly',
    profile: 'Perfil',
    
    // Auth
    welcomeBack: '춰Bienvenido de vuelta a Patitas! 游',
    signInSubtitle: 'Inicia sesi칩n para conectar con tu comunidad de mascotas',
    joinPatitas: '춰칔nete a Patitas! 游',
    createAccountSubtitle: 'Crea tu cuenta y comienza a conectar con amantes de las mascotas',
    email: 'Correo electr칩nico',
    password: 'Contrase침a',
    confirmPassword: 'Confirmar contrase침a',
    fullName: 'Nombre completo',
    signIn: 'Iniciar sesi칩n',
    signUp: 'Registrarse',
    createAccount: 'Crear cuenta',
    dontHaveAccount: '쯅o tienes una cuenta?',
    alreadyHaveAccount: '쯏a tienes una cuenta?',
    signOut: 'Cerrar sesi칩n',
    forgotPassword: '쯆lvidaste tu contrase침a?',
    rememberPassword: 'Recordar contrase침a',
    
    // Home/Feed
    searchPets: 'Buscar mascotas...',
    likesCount: 'me gusta',
    viewComments: 'Ver los {count} comentarios',
    hoursAgo: 'h',
    noPostsYet: '춰A칰n no hay publicaciones!',
    beFirstToPost: 'S칠 el primero en compartir algo sobre tu mascota',
    loadingPosts: 'Cargando publicaciones...',
    
    // Pets
    addPet: 'Agregar mascota',
    yearsOld: 'a침os',
    addFirstPet: '춰Agrega tu primera mascota! 游',
    createPetProfile: 'Comienza creando el perfil de tu compa침ero peludo',
    loadingPets: 'Cargando mascotas...',
    petDetails: 'Detalles de la mascota',
    editPet: 'Editar mascota',
    deletePet: 'Eliminar mascota',
    petName: 'Nombre de la mascota',
    species: 'Especie',
    breed: 'Raza',
    age: 'Edad',
    weight: 'Peso',
    gender: 'G칠nero',
    male: 'Macho',
    female: 'Hembra',
    neutered: 'Castrado/Esterilizado',
    hasChip: 'Tiene microchip',
    chipNumber: 'N칰mero de microchip',
    description: 'Descripci칩n',
    selectSpecies: 'Seleccionar especie',
    selectBreed: 'Seleccionar raza',
    dog: 'Perro',
    cat: 'Gato',
    years: 'a침os',
    months: 'meses',
    days: 'd칤as',
    kg: 'kg',
    lb: 'lb',
    
    // Shop
    petShop: 'Tienda de Mascotas',
    addToCart: 'Agregar al carrito',
    reviews: 'rese침as',
    all: 'Todo',
    food: 'Comida',
    toys: 'Juguetes',
    accessories: 'Accesorios',
    health: 'Salud',
    hygiene: 'Higiene',
    noProductsAvailable: 'No hay productos disponibles',
    noProductsInCategory: 'No hay productos en esta categor칤a',
    loadingProducts: 'Cargando productos...',
    productDetails: 'Detalles del producto',
    price: 'Precio',
    stock: 'Stock',
    category: 'Categor칤a',
    brand: 'Marca',
    addToCartSuccess: 'Producto agregado al carrito',
    cart: 'Carrito',
    myCart: 'Mi Carrito',
    cartEmpty: 'Tu carrito est치 vac칤o',
    cartEmptySubtitle: 'Agrega productos de la tienda para comenzar tu compra',
    goToShop: 'Ir a la Tienda',
    quantity: 'Cantidad',
    subtotal: 'Subtotal',
    shipping: 'Env칤o',
    total: 'Total',
    checkout: 'Finalizar compra',
    shippingAddress: 'Direcci칩n de env칤o',
    orderSummary: 'Resumen del pedido',
    payWithMercadoPago: 'Pagar con Mercado Pago',
    
    // Services
    petServices: 'Servicios para Mascotas',
    veterinary: 'Veterinario',
    grooming: 'Peluquer칤a',
    walking: 'Paseo',
    boarding: 'Pensi칩n',
    noServicesAvailable: 'No hay servicios disponibles',
    noBusinessInCategory: 'No hay negocios disponibles en esta categor칤a',
    loadingServices: 'Cargando servicios...',
    serviceDetails: 'Detalles del servicio',
    bookService: 'Reservar servicio',
    duration: 'Duraci칩n',
    location: 'Ubicaci칩n',
    contact: 'Contactar',
    bookingSuccess: 'Reserva realizada con 칠xito',
    selectPet: 'Selecciona tu mascota',
    selectDate: 'Selecciona una fecha',
    selectTime: 'Selecciona una hora',
    bookingNotes: 'Notas para el proveedor',
    confirmBooking: 'Confirmar reserva',
    signInToViewServices: 'Debes iniciar sesi칩n para ver los servicios disponibles',
    
    // Profile
    editProfile: 'Editar perfil',
    partnerMode: 'Modo Aliado',
    partnerModeOn: 'Est치s en modo Aliado. Puedes gestionar tus servicios y reservas.',
    partnerModeOff: 'Cambia a modo Aliado para ofrecer servicios a otros due침os de mascotas.',
    myStats: 'Mis estad칤sticas',
    pets: 'Mascotas',
    posts: 'Publicaciones',
    followers: 'Seguidores',
    following: 'Siguiendo',
    notifications: 'Notificaciones',
    privacySecurity: 'Privacidad y seguridad',
    helpSupport: 'Ayuda y soporte',
    language: 'Idioma',
    spanish: 'Espa침ol',
    english: 'Ingl칠s',
    registerBusiness: 'Registrar Negocio',
    myOrders: 'Mis Pedidos',
    biometricAuth: 'Autenticaci칩n biom칠trica',
    profilePhoto: 'Foto de perfil',
    basicInfo: 'Informaci칩n b치sica',
    fullNameLabel: 'Nombre completo',
    emailLabel: 'Correo electr칩nico',
    phoneLabel: 'Tel칠fono',
    addressLabel: 'Direcci칩n',
    bioLabel: 'Biograf칤a',
    saveChanges: 'Guardar cambios',
    profileUpdated: 'Perfil actualizado correctamente',
    adminMode: 'Modo Administrador',
    goToAdmin: 'Ir a Admin',
    pendingVerification: 'Pendiente de verificaci칩n',
    noBusinessRegistered: 'Sin negocio registrado',
    adminModeDescription: 'Accede al panel de administraci칩n para gestionar la plataforma.',
    requestUnderReview: 'Tu solicitud est치 siendo revisada por un administrador.',
    canRegisterBusiness: 'Puedes registrar uno o m치s negocios para ofrecer servicios a otros due침os de mascotas',
    enterCompleteAddress: 'Ingresa tu direcci칩n completa',
    products: 'productos',
    shippingByStore: 'Env칤o por tienda',
    noShipping: 'Sin env칤o',
    calculating: 'Calculando',
    
    // Orders
    orders: 'Pedidos',
    orderHistory: 'Historial de pedidos',
    activeOrders: 'Pedidos activos',
    completedOrders: 'Pedidos completados',
    orderNumber: 'N칰mero de pedido',
    orderDate: 'Fecha del pedido',
    orderStatus: 'Estado del pedido',
    orderTotal: 'Total del pedido',
    pending: 'Pendiente',
    confirmed: 'Confirmado',
    processing: 'En proceso',
    shipped: 'Enviado',
    delivered: 'Entregado',
    cancelled: 'Cancelado',
    trackOrder: 'Rastrear pedido',
    reorder: 'Reordenar',
    orderDetails: 'Detalles del pedido',
    
    // Health
    health: 'Salud',
    vaccines: 'Vacunas',
    illnesses: 'Enfermedades',
    allergies: 'Alergias',
    deworming: 'Desparasitaciones',
    weightTracking: 'Seguimiento de peso',
    addVaccine: 'Agregar vacuna',
    addIllness: 'Agregar enfermedad',
    addAllergy: 'Agregar alergia',
    addDeworming: 'Agregar desparasitaci칩n',
    addWeight: 'Agregar peso',
    vaccineName: 'Nombre de la vacuna',
    applicationDate: 'Fecha de aplicaci칩n',
    nextDueDate: 'Pr칩xima dosis',
    veterinarian: 'Veterinario',
    notes: 'Notas',
    illnessName: 'Nombre de la enfermedad',
    diagnosisDate: 'Fecha de diagn칩stico',
    treatment: 'Tratamiento',
    allergyName: 'Al칠rgeno',
    symptoms: 'S칤ntomas',
    severity: 'Severidad',
    productName: 'Producto utilizado',
    weightValue: 'Peso',
    weightUnit: 'Unidad',
    date: 'Fecha',
    
    // Albums
    albums: '츼lbumes',
    addPhotos: 'Agregar fotos',
    albumTitle: 'T칤tulo del 치lbum',
    albumDescription: 'Descripci칩n del 치lbum',
    shareInFeed: 'Compartir en el feed',
    saveToAlbum: 'Guardar en 치lbum',
    takePhoto: 'Tomar foto',
    selectFromGallery: 'Seleccionar de galer칤a',
    photosSelected: 'fotos seleccionadas',
    noAlbums: 'No hay 치lbumes creados',
    createFirstAlbum: 'Crea tu primer 치lbum de fotos',
    
    // Common
    loading: 'Cargando...',
    error: 'Error',
    fillAllFields: 'Por favor completa todos los campos',
    passwordsDontMatch: 'Las contrase침as no coinciden',
    passwordTooShort: 'La contrase침a debe tener al menos 6 caracteres',
    save: 'Guardar',
    cancel: 'Cancelar',
    delete: 'Eliminar',
    edit: 'Editar',
    add: 'Agregar',
    remove: 'Eliminar',
    confirm: 'Confirmar',
    back: 'Volver',
    next: 'Siguiente',
    previous: 'Anterior',
    close: 'Cerrar',
    open: 'Abrir',
    yes: 'S칤',
    no: 'No',
    ok: 'OK',
    retry: 'Reintentar',
    refresh: 'Actualizar',
    search: 'Buscar',
    filter: 'Filtrar',
    sort: 'Ordenar',
    view: 'Ver',
    share: 'Compartir',
    like: 'Me gusta',
    comment: 'Comentar',
    follow: 'Seguir',
    unfollow: 'Dejar de seguir',
    min: 'min',
    hour: 'hora',
    hours: 'horas',
    day: 'd칤a',
    days: 'd칤as',
    week: 'semana',
    weeks: 'semanas',
    month: 'mes',
    months: 'meses',
    year: 'a침o',
    today: 'Hoy',
    yesterday: 'Ayer',
    tomorrow: 'Ma침ana',
    now: 'Ahora',
    recently: 'Recientemente',
  },
  en: {
    // Navigation
    home: 'Home',
    myPets: 'My Pets',
    shop: 'Shop',
    services: 'Services',
    petFriendly: 'Pet Friendly',
    profile: 'Profile',
    
    // Auth
    welcomeBack: 'Welcome Back to DogCatiFy! 游',
    signInSubtitle: 'Sign in to connect with your pet community',
    joinPatitas: 'Join DogCatiFy! 游',
    createAccountSubtitle: 'Create your account and start connecting with pet lovers',
    email: 'Email',
    password: 'Password',
    confirmPassword: 'Confirm Password',
    fullName: 'Full Name',
    signIn: 'Sign In',
    signUp: 'Sign Up',
    createAccount: 'Create Account',
    dontHaveAccount: "Don't have an account?",
    alreadyHaveAccount: 'Already have an account?',
    signOut: 'Sign Out',
    forgotPassword: 'Forgot your password?',
    rememberPassword: 'Remember password',
    
    // Home/Feed
    searchPets: 'Search pets...',
    likesCount: 'likes',
    viewComments: 'View {count} comments',
    hoursAgo: 'h',
    noPostsYet: 'No posts yet!',
    beFirstToPost: 'Be the first to share something about your pet',
    loadingPosts: 'Loading posts...',
    
    // Pets
    addPet: 'Add Pet',
    yearsOld: 'years old',
    addFirstPet: 'Add your first pet! 游',
    createPetProfile: 'Start by creating your furry companion\'s profile',
    loadingPets: 'Loading pets...',
    petDetails: 'Pet details',
    editPet: 'Edit pet',
    deletePet: 'Delete pet',
    petName: 'Pet name',
    species: 'Species',
    breed: 'Breed',
    age: 'Age',
    weight: 'Weight',
    gender: 'Gender',
    male: 'Male',
    female: 'Female',
    neutered: 'Neutered/Spayed',
    hasChip: 'Has microchip',
    chipNumber: 'Microchip number',
    description: 'Description',
    selectSpecies: 'Select species',
    selectBreed: 'Select breed',
    dog: 'Dog',
    cat: 'Cat',
    years: 'years',
    months: 'months',
    days: 'days',
    kg: 'kg',
    lb: 'lb',
    
    // Shop
    petShop: 'Pet Shop',
    addToCart: 'Add to Cart',
    reviews: 'reviews',
    all: 'All',
    food: 'Food',
    toys: 'Toys',
    accessories: 'Accessories',
    health: 'Health',
    hygiene: 'Hygiene',
    noProductsAvailable: 'No products available',
    noProductsInCategory: 'No products in this category',
    loadingProducts: 'Loading products...',
    productDetails: 'Product details',
    price: 'Price',
    stock: 'Stock',
    category: 'Category',
    brand: 'Brand',
    addToCartSuccess: 'Product added to cart',
    cart: 'Cart',
    myCart: 'My Cart',
    cartEmpty: 'Your cart is empty',
    cartEmptySubtitle: 'Add products from the store to start shopping',
    goToShop: 'Go to Shop',
    quantity: 'Quantity',
    subtotal: 'Subtotal',
    shipping: 'Shipping',
    total: 'Total',
    checkout: 'Checkout',
    shippingAddress: 'Shipping address',
    orderSummary: 'Order summary',
    payWithMercadoPago: 'Pay with Mercado Pago',
    
    // Services
    petServices: 'Pet Services',
    veterinary: 'Veterinary',
    grooming: 'Grooming',
    walking: 'Walking',
    boarding: 'Boarding',
    noServicesAvailable: 'No services available',
    noBusinessInCategory: 'No businesses available in this category',
    loadingServices: 'Loading services...',
    serviceDetails: 'Service details',
    bookService: 'Book service',
    duration: 'Duration',
    location: 'Location',
    contact: 'Contact',
    bookingSuccess: 'Booking successful',
    selectPet: 'Select your pet',
    selectDate: 'Select a date',
    selectTime: 'Select a time',
    bookingNotes: 'Notes for provider',
    confirmBooking: 'Confirm booking',
    signInToViewServices: 'You must sign in to view available services',
    
    // Profile
    editProfile: 'Edit Profile',
    partnerMode: 'Partner Mode',
    partnerModeOn: 'You are in Partner mode. You can manage your services and bookings.',
    partnerModeOff: 'Switch to Partner mode to offer services to other pet owners.',
    myStats: 'My Stats',
    pets: 'Pets',
    posts: 'Posts',
    followers: 'Followers',
    following: 'Following',
    notifications: 'Notifications',
    privacySecurity: 'Privacy & Security',
    helpSupport: 'Help & Support',
    language: 'Language',
    spanish: 'Spanish',
    english: 'English',
    registerBusiness: 'Register Business',
    myOrders: 'My Orders',
    biometricAuth: 'Biometric authentication',
    profilePhoto: 'Profile photo',
    basicInfo: 'Basic information',
    fullNameLabel: 'Full name',
    emailLabel: 'Email address',
    phoneLabel: 'Phone number',
    addressLabel: 'Address',
    bioLabel: 'Biography',
    saveChanges: 'Save changes',
    profileUpdated: 'Profile updated successfully',
    adminMode: 'Admin Mode',
    goToAdmin: 'Go to Admin',
    pendingVerification: 'Pending verification',
    noBusinessRegistered: 'No business registered',
    adminModeDescription: 'Access the admin panel to manage the platform.',
    requestUnderReview: 'Your request is being reviewed by an administrator.',
    canRegisterBusiness: 'You can register one or more businesses to offer services to other pet owners',
    enterCompleteAddress: 'Enter your complete address',
    products: 'products',
    shippingByStore: 'Shipping by store',
    noShipping: 'No shipping',
    calculating: 'Calculating',
    
    // Orders
    orders: 'Orders',
    orderHistory: 'Order history',
    activeOrders: 'Active orders',
    completedOrders: 'Completed orders',
    orderNumber: 'Order number',
    orderDate: 'Order date',
    orderStatus: 'Order status',
    orderTotal: 'Order total',
    pending: 'Pending',
    confirmed: 'Confirmed',
    processing: 'Processing',
    shipped: 'Shipped',
    delivered: 'Delivered',
    cancelled: 'Cancelled',
    trackOrder: 'Track order',
    reorder: 'Reorder',
    orderDetails: 'Order details',
    
    // Health
    health: 'Health',
    vaccines: 'Vaccines',
    illnesses: 'Illnesses',
    allergies: 'Allergies',
    deworming: 'Deworming',
    weightTracking: 'Weight tracking',
    addVaccine: 'Add vaccine',
    addIllness: 'Add illness',
    addAllergy: 'Add allergy',
    addDeworming: 'Add deworming',
    addWeight: 'Add weight',
    vaccineName: 'Vaccine name',
    applicationDate: 'Application date',
    nextDueDate: 'Next due date',
    veterinarian: 'Veterinarian',
    notes: 'Notes',
    illnessName: 'Illness name',
    diagnosisDate: 'Diagnosis date',
    treatment: 'Treatment',
    allergyName: 'Allergen',
    symptoms: 'Symptoms',
    severity: 'Severity',
    productName: 'Product used',
    weightValue: 'Weight',
    weightUnit: 'Unit',
    date: 'Date',
    
    // Albums
    albums: 'Albums',
    addPhotos: 'Add photos',
    albumTitle: 'Album title',
    albumDescription: 'Album description',
    shareInFeed: 'Share in feed',
    saveToAlbum: 'Save to album',
    takePhoto: 'Take photo',
    selectFromGallery: 'Select from gallery',
    photosSelected: 'photos selected',
    noAlbums: 'No albums created',
    createFirstAlbum: 'Create your first photo album',
    
    // Common
    loading: 'Loading...',
    error: 'Error',
    success: 'Success',
    fillAllFields: 'Please fill in all fields',
    passwordsDontMatch: 'Passwords do not match',
    passwordTooShort: 'Password must be at least 6 characters',
    save: 'Save',
    cancel: 'Cancel',
    delete: 'Delete',
    edit: 'Edit',
    add: 'Add',
    remove: 'Remove',
    confirm: 'Confirm',
    back: 'Back',
    next: 'Next',
    previous: 'Previous',
    close: 'Close',
    open: 'Open',
    yes: 'Yes',
    no: 'No',
    ok: 'OK',
    retry: 'Retry',
    refresh: 'Refresh',
    search: 'Search',
    filter: 'Filter',
    sort: 'Sort',
    view: 'View',
    share: 'Share',
    like: 'Like',
    comment: 'Comment',
    follow: 'Follow',
    unfollow: 'Unfollow',
    min: 'min',
    hour: 'hour',
    hours: 'hours',
    day: 'day',
    days: 'days',
    week: 'week',
    weeks: 'weeks',
    month: 'month',
    months: 'months',
    year: 'year',
    today: 'Today',
    yesterday: 'Yesterday',
    tomorrow: 'Tomorrow',
    now: 'Now',
    recently: 'Recently',
  },
};

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const useLanguage = () => {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useLanguage must be used within a LanguageProvider');
  }
  return context;
};

export const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [language, setLanguageState] = useState<Language>('es');

  useEffect(() => {
    loadLanguage();
  }, []);

  const loadLanguage = async () => {
    try {
      const savedLanguage = await AsyncStorage.getItem('language');
      if (savedLanguage && (savedLanguage === 'es' || savedLanguage === 'en')) {
        setLanguageState(savedLanguage);
      }
    } catch (error) {
      console.error('Error loading language:', error);
    }
  };

  const setLanguage = async (lang: Language) => {
    try {
      await AsyncStorage.setItem('language', lang);
      setLanguageState(lang);
    } catch (error) {
      console.error('Error saving language:', error);
    }
  };

  const t = (key: string): string => {
    const keys = key.split('.');
    let value: any = translations[language];
    
    for (const k of keys) {
      value = value?.[k];
    }
    
    return value || key;
  };

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
};